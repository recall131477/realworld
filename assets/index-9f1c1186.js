import{e as U,p as E,k as V,s as Z,f as s,q as j,v as H,r as B,o as u,c as _,b as e,j as D,w,m as M,t as d,l as $,F,a as x,d as v,n as N,x as R,y as q,z as G,A as K,B as W,u as J,C as X,D as Q,E as Y,G as ee,H as te,g as oe,i as P,I as ae,J as se,K as I}from"./index-abc583f2.js";import{_ as re}from"./Loading.vue_vue_type_script_setup_true_lang-07321e25.js";import{f as z}from"./index-6f68b1e3.js";import{d as ne}from"./index-7324e164.js";const le={class:"flex flex-wrap items-center gap-x-6 gap-y-4"},ie={class:"flex items-center gap-x-2"},ce=["src","alt"],ue={class:"block text-xs text-[#bbb]"},de={class:"flex flex-wrap gap-2"},me=e("i",{class:"ion-edit space"}," ",-1),pe=["disabled"],ve=e("i",{class:"ion-trash-a"}," ",-1),fe=["disabled"],he=e("i",{class:"ion-plus-round"}," ",-1),_e=["disabled"],ge=e("i",{class:"ion-heart"}," ",-1),be={name:"ArticleMetaComponent"},O=U({...be,props:{article:{}},emits:["update-follow","update-favorite"],setup(S,{emit:g}){const f=S,b=E(),i=V(),{userInfo:r,isLoggedIn:c}=Z(i),t=s(JSON.parse(JSON.stringify(f.article))),o=s(!1),m=s(!1),n=s(!1),h=s({}),C=j(()=>{var l;return c&&((l=r.value)==null?void 0:l.username)===t.value.author.username}),k=async()=>{c.value||b.push({name:"login"}),m.value=!0;try{t.value.author.following?await R(t.value.author.username):await q(t.value.author.username),g("update-follow")}catch(l){h.value=l.errors}m.value=!1},p=async()=>{c.value||b.push({name:"login"}),n.value=!0;try{const l=t.value.favorited?await G(t.value.slug):await K(t.value.slug);g("update-favorite",l.data.article)}catch(l){h.value=l.errors}n.value=!1},L=async()=>{o.value=!0;try{await W(t.value.slug),b.push({name:"global-feed"})}catch(l){h.value=l.errors}o.value=!1};return H(()=>f.article,l=>{t.value=JSON.parse(JSON.stringify(l))},{deep:!0}),(l,a)=>{const y=B("router-link");return u(),_("div",le,[e("div",ie,[t.value.author.username?(u(),D(y,{key:0,to:{name:"profile",params:{username:t.value.author.username}}},{default:w(()=>[e("img",{class:"h-8 w-8 rounded-full object-cover",src:t.value.author.image,alt:t.value.author.username},null,8,ce)]),_:1},8,["to"])):M("",!0),e("div",null,[t.value.author.username?(u(),D(y,{key:0,to:{name:"profile",params:{username:t.value.author.username}},class:"block font-medium"},{default:w(()=>[v(d(t.value.author.username),1)]),_:1},8,["to"])):M("",!0),e("span",ue,d($(z)(t.value.createdAt)),1)])]),e("div",de,[C.value?(u(),_(F,{key:0},[x(y,{to:{name:"edit-article",params:{slug:t.value.slug}},class:"inline-block rounded border border-[#ccc] px-2 py-1 text-sm leading-tight text-[#ccc] duration-300 hover:bg-[#ccc] hover:text-[#373a3c]"},{default:w(()=>[me,v(" Edit Article ")]),_:1},8,["to"]),e("button",{type:"button",class:"inline-block rounded border border-danger px-2 py-1 text-sm leading-tight text-danger duration-300 hover:bg-danger hover:text-white",disabled:o.value,onClick:L},[ve,v(" Delete Article ")],8,pe)],64)):(u(),_(F,{key:1},[e("button",{type:"button",class:N(["inline-block rounded border border-[#ccc] px-2 py-1 text-sm leading-tight duration-300 hover:bg-white hover:text-[#373a3c] disabled:pointer-events-none disabled:opacity-60",t.value.author.following?"bg-white text-[#373a3c]":"text-[#ccc]"]),disabled:m.value,onClick:k},[he,v(" "+d(t.value.author.following?"Unfollow":"Follow")+" "+d(t.value.author.username),1)],10,fe),e("button",{type:"button",class:N(["inline-block rounded border border-primary px-2 py-1 text-sm leading-tight duration-300 hover:bg-primary hover:text-white disabled:pointer-events-none disabled:opacity-60",t.value.favorited?"bg-primary text-white":"text-primary"]),disabled:n.value,onClick:p},[ge,v(" "+d(t.value.favorited?"Unfavorite Article":"Favorite Article")+" ",1),e("span",null,"("+d(t.value.favoritesCount)+")",1)],10,_e)],64))])])}}}),xe=["disabled"],ye={class:"flex justify-between border-t border-[#e5e5e5] bg-[#f5f5f5] px-5 py-3"},we=["src","alt"],Ce=["disabled"],ke={name:"CommentFormComponent"},$e=U({...ke,emits:["create-comment"],setup(S,{emit:g}){const f=J(),b=V(),{userInfo:i}=Z(b),r=s(""),c=s(!1),t=s({}),o=async()=>{if(r.value!==""){c.value=!0;try{const n=await ee(f.params.slug,{comment:{body:r.value}});g("create-comment",n.data.comment),r.value=""}catch(n){t.value=n.errors}c.value=!1}},m=ne(()=>{o()},250);return(n,h)=>{var C,k;return u(),_("form",{class:"rounded border border-[#e5e5e5]",onSubmit:h[1]||(h[1]=Y((...p)=>$(m)&&$(m)(...p),["prevent"]))},[X(e("textarea",{class:"block w-full resize-none rounded bg-white p-5 leading-tight text-[#55595c] outline-none disabled:pointer-events-none disabled:bg-[#eceeef]",rows:"3",placeholder:"Write a comment...",disabled:c.value,"onUpdate:modelValue":h[0]||(h[0]=p=>r.value=p)},null,8,xe),[[Q,r.value,void 0,{trim:!0}]]),e("div",ye,[e("img",{src:(C=$(i))==null?void 0:C.image,alt:(k=$(i))==null?void 0:k.username,class:"h-[30px] w-[30px] rounded-full"},null,8,we),e("button",{type:"submit",class:"inline-block rounded bg-primary px-2 py-1 text-sm text-white duration-300 hover:bg-primary-dark disabled:pointer-events-none disabled:opacity-60",disabled:c.value||r.value===""}," Post Comment ",8,Ce)])],32)}}}),Ae={class:"rounded border border-[#e5e5e5]"},Se={class:"p-5"},Te={class:"flex items-center justify-between border-t border-[#e5e5e5] bg-[#f5f5f5] px-5 py-3 text-sm"},Fe={class:"flex items-center gap-x-2"},De=["src","alt"],Ue={class:"text-[#bbb]"},Le=e("i",{class:"ion-trash-a"},null,-1),Ie=[Le],Ne={name:"CommentPreviewComponent"},Ve=U({...Ne,props:{comment:{}},emits:["delete-comment"],setup(S,{emit:g}){const f=S,b=J(),i=s(!1),r=s({}),c=j(()=>{const o=new Date(f.comment.createdAt),m=o.getHours().toString().padStart(2,"0"),n=o.getMinutes().toString().padStart(2,"0");return`${m}:${n}`}),t=async()=>{i.value=!0;try{await te(b.params.slug,f.comment.id),g("delete-comment",f.comment.id)}catch(o){r.value=o.errors}i.value=!1};return(o,m)=>{const n=B("router-link");return u(),_("div",Ae,[e("div",Se,[e("p",null,d(o.comment.body),1)]),e("div",Te,[e("div",Fe,[x(n,{to:{name:"profile",params:{username:o.comment.author.username}}},{default:w(()=>[e("img",{class:"h-5 w-5 rounded-full",src:o.comment.author.image,alt:o.comment.author.username},null,8,De)]),_:1},8,["to"]),x(n,{class:"text-primary",to:{name:"profile",params:{username:o.comment.author.username}}},{default:w(()=>[v(d(o.comment.author.username),1)]),_:1},8,["to"]),e("span",Ue,d($(z)(o.comment.createdAt))+" "+d(c.value),1)]),e("span",{class:N(["cursor-pointer text-base text-[#333] opacity-60 duration-300 hover:opacity-100",i.value?"pointer-events-none":"pointer-events-auto"]),onClick:t},Ie,2)])])}}}),Ze={class:"bg-[#333] py-8 text-white"},je={class:"mx-auto max-w-[1140px] px-[15px]"},Be={class:"mb-8 text-[44px] font-semibold leading-none"},Je={class:"pt-8"},Me={class:"mx-auto max-w-[1140px] px-[15px]"},Pe={class:"font-serif text-lg"},Oe={class:"mt-8 flex gap-1"},ze={class:"mb-12 mt-8 border-t border-black/10 pt-6"},Ee={class:"flex justify-center"},He={class:"space-y-3 md:mx-auto md:w-2/3"},Re={key:1},qe={name:"ArticleView"},Qe=U({...qe,setup(S){const g=J(),f=V(),{isLoggedIn:b}=Z(f),i=s({slug:"",title:"",description:"",body:"",tagList:[],createdAt:"",updatedAt:"",favorited:!1,favoritesCount:0,author:{username:"",image:"",bio:"",following:!1}}),r=s([]),c=s(!1),t=s({}),o=async()=>{try{const a=await ae(g.params.slug);i.value=a.data.article}catch(a){t.value=a.errors}},m=async()=>{try{const a=await se(g.params.slug);r.value=a.data.comments}catch(a){t.value=a.errors}},n=a=>{r.value.push(a)},h=a=>{const y=r.value.findIndex(T=>T.id===a);r.value.splice(y,1)},C=()=>{i.value.author.following=!i.value.author.following},k=a=>{i.value.favorited=a.favorited,i.value.favoritesCount=a.favoritesCount};oe(async()=>{c.value=!0;try{await Promise.all([o(),m()])}catch(a){t.value=a.errors}c.value=!1});const p=s({slug:"understanding-typescript-generics",title:"深入了解 TypeScript 泛型",description:"學習如何有效使用 TypeScript 的泛型功能。",body:"泛型是 TypeScript 中一個非常強大的工具，可以用來撰寫靈活又可重複使用的程式碼...",tagList:["TypeScript","泛型","程式設計"],createdAt:"2024-11-19T08:30:00Z",updatedAt:"2024-11-19T10:00:00Z",favorited:!0,favoritesCount:120,author:{username:"程式達人",bio:"熱愛程式設計，喜歡分享知識。",image:I,following:!1}}),L=s([{id:123,createdAt:"2024-11-19T08:30:00Z",updatedAt:"2024-11-19T10:00:00Z",body:"好棒的文章",author:{username:"前端高手",bio:"專職於前端開發，也是 UI/UX 愛好者。",image:I,following:!0}},{id:456,createdAt:"2024-11-17T09:00:00Z",updatedAt:"2024-11-17T09:45:00Z",body:"受益良多",author:{username:"CSS 女王",bio:"熱愛所有與樣式設計相關的事物。",image:I,following:!1}}]),l=j(()=>L.value.slice().sort((a,y)=>new Date(y.createdAt).getTime()-new Date(a.createdAt).getTime()));return(a,y)=>{const T=B("router-link");return u(),_(F,null,[x(re,{isLoading:c.value},null,8,["isLoading"]),e("div",Ze,[e("div",je,[e("h1",Be,d(p.value.title),1),x(O,{article:p.value,onUpdateFollow:C,onUpdateFavorite:k},null,8,["article"])])]),e("div",Je,[e("div",Me,[e("div",Pe,d(p.value.body),1),e("ul",Oe,[(u(!0),_(F,null,P(p.value.tagList,A=>(u(),_("li",{key:A},[x(T,{to:{name:"tag",params:{tag:A}},class:"rounded-full border border-[#ddd] px-2 text-sm font-light text-[#aaa]"},{default:w(()=>[v(d(A),1)]),_:2},1032,["to"])]))),128))]),e("div",ze,[e("div",Ee,[x(O,{article:p.value,onUpdateFollow:C,onUpdateFavorite:k},null,8,["article"])])]),e("div",He,[$(b)?(u(),D($e,{key:0,onCreateComment:n})):(u(),_("p",Re,[x(T,{to:{name:"login"},class:"duration-300 hover:border-b hover:border-black"},{default:w(()=>[v(" Sign in ")]),_:1}),v(" or "),x(T,{to:{name:"register"},class:"duration-300 hover:border-b hover:border-black"},{default:w(()=>[v(" Sign up ")]),_:1}),v(" to add comments on this article. ")])),(u(!0),_(F,null,P(l.value,A=>(u(),D(Ve,{key:A.id,comment:A,onDeleteComment:h},null,8,["comment"]))),128))])])])],64)}}});export{Qe as default};
